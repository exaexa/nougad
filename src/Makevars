
# use `Sys.setenv` to choose a different compute capability
NOUGAD_CUDA_CC ?= 60

CXX_STD = CXX17

NVCC = nvcc -std=c++17

PKG_LIBS = $(shell pkg-config cuda --libs) -lcudart
PKG_CPPFLAGS = -I./include -I./kernels $(shell pkg-config cuda --cflags)
PKG_CXXFLAGS = -Wall -O3 -DNDEBUG -fPIC

NVCCFLAGS = -ccbin $(CXX17) $(PKG_CPPFLAGS) -Xcompiler "-fPIC" -gencode=arch=compute_$(NOUGAD_CUDA_CC),code=sm_$(NOUGAD_CUDA_CC)

CUDA_SOURCES = kernels/nougad.cu
CUDA_OBJECTS = $(CUDA_SOURCES:.cu=.cuo)

CXX_SOURCES = nougad.cpp
CXX_OBJECTS = $(CXX_SOURCES:.cpp=.o)

OBJECTS = $(CXX_OBJECTS) $(CUDA_OBJECTS)

all: nougad.so

nougad.so: $(OBJECTS)

%.cuo: %.cu
	$(NVCC) $(NVCCFLAGS) --compile -cudart static $< -o $@
